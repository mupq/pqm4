// SPDX-License-Identifier: MIT

#ifndef AIM2_H
#define AIM2_H

#include "field.h"
#include "params.h"
#include <stdint.h>

static const GF aim2_constants[AIM2_NUM_INPUT_SBOX] =
{
  {0x13198a2e03707344, 0x243f6a8885a308d3},
  {0x082efa98ec4e6c89, 0xa4093822299f31d0},
};

static const GF aim2_e1_power_matrix[AIM2_NUM_BITS_FIELD] =
{
  {0x0000000000000001, 0x0000000000000000},
  {0xb87c1159421de6c0, 0xfbcf8c1e442c8cf5},
  {0x687634c0bd8f66a6, 0x4d328e5ae8b1bde5},
  {0x742a6036d93c2057, 0x08974511b147a2fe},
  {0xc8b21bf16608e4db, 0x4d758c29eeb484f7},
  {0x0b5c6d5c43980a3c, 0x82739c986dfbdb20},
  {0x0ace7f98da3711b9, 0x34f149a76cf782b0},
  {0x321995ec53ea9914, 0xc2ff5007f8a98c83},
  {0x939b53119c4b7496, 0x097da6d2e8f7686d},
  {0x5fb6dd3ca90cff95, 0x10f77bb9e7748ed3},
  {0x55194932141d0937, 0xc253f8ea7ac0779a},
  {0xb2a4b4591251916b, 0xdfef8e3e1b142c07},
  {0x14df24dfc33e1f4f, 0x931f7bdb443197a1},
  {0xbd4cbe8b919dbb07, 0x24128da6bf057bc8},
  {0x1be6a922a8d0d7d4, 0xb7330162b6115e90},
  {0xb6d9e6635ec916aa, 0x930f20cea1c668e0},
  {0xccbb31a458da0423, 0x60488351c7403436},
  {0xef86b4dbc4263e4d, 0x9237f55823767eae},
  {0xe2a0e301bed0748a, 0x967e64f599297f3c},
  {0x2fde9314f05105e5, 0x58f5315e0e29e358},
  {0xc9e5b15be18b7596, 0xa305f4f11aaa8ad2},
  {0xa592cb3563071925, 0x31b050cca997ed24},
  {0xa55f9e7374b10af1, 0x5904c31aaebea1ed},
  {0xcf6921d88d12bbf2, 0xea5142776b77d368},
  {0x28779ef24c9ddcb5, 0x448bfd74cc624506},
  {0x0d2caf1924759d9a, 0xc66ef14828e98e80},
  {0x312a49ac8d3790db, 0x5121956dac40960a},
  {0x311230a0f0166f37, 0x41cdda4642d1e45a},
  {0x152cd68f8d980779, 0x50accd8f44cc6a3b},
  {0x0e6342e6e178a202, 0xaf2e59b6e13fec01},
  {0xcdfaea274cfff823, 0x008f7a68483d8f8a},
  {0x80183f4571309485, 0xdece92499f9521ba},
  {0xaba321469362905f, 0x3c5814a4c792b3be},
  {0x7e8680766e1d3ffc, 0x7585a167f0b843b8},
  {0x4e81e572c5dbf79a, 0x114bd1d466ef8787},
  {0x3a7e0a403a1da600, 0x014747267c0b38f9},
  {0x23116c4dd539e293, 0x196284a6305e23d7},
  {0xf0a02f00d5a45c0f, 0xae9980fc3aa3cd2e},
  {0x7eae2c6dae8286e9, 0xd2be72a1da8addbc},
  {0xbb8689cb630a9e23, 0x2d1eb9e86163e7f4},
  {0xf0febfb8f6e46561, 0x8eda5ccd665a3ac2},
  {0x370a6880719f8be9, 0x83fe14fe68c33df0},
  {0xe9634dd58474116f, 0xdfb51a0ca76c9c82},
  {0x9c40da32ca69fe52, 0xcecdf64c8559eef4},
  {0xe29f358edce8d40e, 0x9256190cf3cfb1fa},
  {0xb5431f672597e9cd, 0xc69025ae5a99210a},
  {0x0f00e0c670d40d95, 0xdf81e3ce7617b0a1},
  {0x699332d099ea38d7, 0xc24d5671c235f28e},
  {0x89ea2f4529a74b45, 0x7c11f6654369b65d},
  {0xeaa8470e44915e89, 0x049b62170967135b},
  {0x39fb9877aadc951b, 0xba3743d76fda5083},
  {0xe2da8722532e6fbb, 0xdef2a5ff6e028aba},
  {0xb5e975340c6c76a1, 0xf28418e25fbc0144},
  {0x035ab9363f6882be, 0xab56f227d4a26a26},
  {0x273536b8b02dd5f1, 0x75af981a11d43e64},
  {0x846e480a8bc44fa9, 0x507a048207335fa1},
  {0x3808d8fa4fcba922, 0xf632f1c9c802ab76},
  {0x34ecb7872eda1962, 0x2dcfedd3c12f73be},
  {0xf884a540c1b411ea, 0xf77d23a1c6600553},
  {0x0e106a0239843e3c, 0x7d5ef83763344eed},
  {0x4192e743be4ae7d9, 0x5070be659c9249dd},
  {0x6588c07b62dd03ba, 0x09d7b6469e953856},
  {0x790b4af55db42c92, 0x5c859acd40414177},
  {0xedda860c739ca8f7, 0xd728f7e92e3e7940},
  {0xfbcf513b18b860f7, 0xf6fd92c58b52c44d},
  {0x4f1571762119854e, 0x04286d00eb347197},
  {0x3f777b9977ed2aa6, 0xf68288c09c8d73d4},
  {0x538b16a3bd887a20, 0x86437c4cb491c94b},
  {0x3656d64f9fdf8baf, 0x97db137363bf2a7e},
  {0x0582fbdad31a1e6c, 0x213b4a759760ffe0},
  {0xc7f42208feff0a47, 0x05cb6fb77aad0666},
  {0x8f59c644fd5259d4, 0xd3740dabc91a5ecd},
  {0xca19d9ef4ab67cee, 0xa2486f3cdc03c63f},
  {0x8a1f14a7c3d2f88f, 0x71b6e4a0b3d4a2a0},
  {0xe9ee9aa288652690, 0xa28d2266c47e02b2},
  {0x759c7eee1a3eead3, 0x689aa81596670031},
  {0x50a9a3f15e0032ae, 0x206b34f2ed6fc8ff},
  {0x630774b85c40302e, 0xf7f5952347d531a6},
  {0x78886ef4e794267b, 0x7072ec9b3a2ddd8f},
  {0x754c7bf46deec1a2, 0xb360d5ec03ebf053},
  {0x337080ceace4b67a, 0xbe8541809bccdc7d},
  {0x8c243c5d486009a0, 0x87fc6f3fbe554f61},
  {0x58e8f3ccf2596f26, 0xc7a500e89b1b40a6},
  {0x516a6cbee9e76420, 0xe719cb9a5a49f8ed},
  {0x96f150816f90c216, 0x484947f2b48d7882},
  {0xdefb92978dfa0053, 0x58823337d6c0a641},
  {0x98bbc22dd2d3262b, 0xdad5891c70205c95},
  {0xbf1d06e5edc7d9ba, 0xea3e0a86c4241c1e},
  {0x78e2cf480abc18ef, 0x1110bc39a35669cf},
  {0xc188299c1375e7b2, 0x8eb4cf8cb0851480},
  {0xd0ec275048c667d2, 0xff5c57071581e3b1},
  {0x955c8d54a50fdd52, 0xcf79008ac79991d3},
  {0xf46cdcd85b7289c9, 0x1c5fc0acfab2cbb2},
  {0x676f48ac3ed3c825, 0x862183d1a9042f4d},
  {0xf35fc7982c7daee6, 0xa655183af862baae},
  {0x5335bbcaf8b9f37b, 0x963ed04a2a0b3eaa},
  {0x76d009714121cb10, 0x82f1d3e8253374ee},
  {0x50198339f3198270, 0xee023bd013e359f5},
  {0x315d27ea94c7941a, 0x5c1520117e098dbf},
  {0x96ccc513ba987df7, 0x7d84bbe2e504ff94},
  {0x03464584b630d2b7, 0x7d9fc4a633f228f4},
  {0x7e39cbb756cac943, 0x45a5498048f1a474},
  {0x56a90669f7aa29c6, 0x4883787b94c90425},
  {0x9a262b27cb8de6e9, 0x6495beb53f905401},
  {0xdc5866e0159b2920, 0x6c2c9c31b3faab04},
  {0x82f93c693fec7b5f, 0x1926807fb1c2bdd5},
  {0x3a06ca560fda4251, 0xff56ec036c5f13d6},
  {0xcf96fe4ae095a1c3, 0xaea98fd960fd6b9d},
  {0xc2ae3b23e1b73447, 0xe7c1f21b63d4e19c},
  {0x660f92196e62044c, 0xa61e4689ac8893c0},
  {0x4aacc983cc5d9cfe, 0xb71adc881811c258},
  {0xb01938e5f92ea2e0, 0x3d4b38fea83810f8},
  {0x8195527abb10f039, 0x242e99777aeec42a},
  {0x077a36f6536baf7f, 0x928620c22f148a6d},
  {0xb4d16665e8f965a6, 0x300ecf50c00b75a7},
  {0x53d4fbf144350d5c, 0x50967628985e6eaf},
  {0xea67291009feb48e, 0x74a182255aa9ccae},
  {0xe67c52e63c97fb3a, 0xbe1b4991d245fa61},
  {0x6bd8d3685ed38551, 0xc26bdd871e8691e5},
  {0x267c4e3df39e0a7e, 0x2408058c7b3e3c09},
  {0x2bc55550057b4b4e, 0xe70baa2724b374d3},
  {0x0e2984947284c4dd, 0x4f4e64ba26bfee68},
  {0x78891ea4bacdb828, 0x357f7d8801646f08},
  {0x220a9cb569d1ee6b, 0x8e6c9653552802fa},
  {0x6159359f74dda4d7, 0xcbd0c89374b1cc2e},
  {0x8dd5a4c4fe55c89f, 0xeeca37f94d3f69bd},
  {0x22abf1f68e0f314a, 0x69b86caf61d48d15},
  {0xab26c59f1090455d, 0x1a49957d9798f177},
};

static const GF aim2_e2_power_matrix[AIM2_NUM_BITS_FIELD] =
{
  {0x0000000000000001, 0x0000000000000000},
  {0xf50e0632f2a35f5b, 0x386db41096f62a8a},
  {0x1843656b2ea8f397, 0xefdb454053648225},
  {0xfc670d9cf3feeb63, 0x7582326d84c7a1de},
  {0xf1c52011971b40b3, 0x864204566cee644d},
  {0x5d8e354c13ae648b, 0x192b28f22b444709},
  {0x9d5cef9c88eb0d9f, 0xb686d60b99470446},
  {0xc91fa3a9b726fd99, 0xcf7a6d254a105b09},
  {0x048e86e374780c55, 0x9f65220d0c78fc67},
  {0xafa9c90017000acc, 0x83a4540ded360993},
  {0x3e563c2c6efb6102, 0xb7147f0d38fa394e},
  {0x858e694ad98264cb, 0x184d72cdc205efdb},
  {0x260f2eae08292a50, 0x101cdb156939622a},
  {0x4a9a43781e99484d, 0x8b9b7c41b6c639f6},
  {0x16c9831c810a7459, 0xcb60c983013050be},
  {0x96d02af1b8d2cba8, 0xb37b4c2c6ea27c34},
  {0x3caadfab02ea679d, 0x6c3124a15e087d32},
  {0xf0892e59955b87ae, 0xaab1aa69ba6853d8},
  {0x8420916c212205ac, 0x86ed9039af31291c},
  {0x0610fd444421f178, 0xa6b004a839e31b64},
  {0xaebf5d9bae4e4ac1, 0x54bf9e6ec57b2d65},
  {0x28bce750ebcba70e, 0x4ce04f578ca77d4d},
  {0xe35d48d89312441e, 0xe6d91969fd74895a},
  {0xcca901ef7fabb1c5, 0x117d2c0c4032a05b},
  {0x4d05be0c6a5a2edc, 0x8314aecc100fcba9},
  {0x7c685f4133a51825, 0x9acd72f51105c28b},
  {0x5011fb2faa2c215a, 0xf33e2515d2bd65e4},
  {0xcec542879e66d1d0, 0xb35dca22a0c3ce97},
  {0x40849b4ce23375b2, 0x92453c68d163c3cb},
  {0x807af8ab827e3617, 0x9aa0b258c13e1db7},
  {0x02cf8f1292f7c659, 0x188599535df660bb},
  {0x675c7dfe865c4b21, 0x60e7e01162356b69},
  {0xdca8758ed620dd7b, 0x40e2dfc1450698ca},
  {0xd4785af596fd0c85, 0x194dcdf10572a8d6},
  {0x39c75c8db5a743fd, 0xaaff1be5fb825c25},
  {0x76f287eaaf80a26e, 0x6d5c3d924e633b50},
  {0xf3289f813d56fa87, 0x8a5781160603ae34},
  {0x023097d7bf57b560, 0x5c09da41ceda1dab},
  {0xaa7caa9af1506059, 0xd65b5a005d02edd2},
  {0x837d13e5bec17d5c, 0x96732ad7e569d594},
  {0xfca9d80d257930ce, 0xbb07355f7df706c0},
  {0x7e719f925352363e, 0x61f17c3d17da7386},
  {0xbdd686a4862a5d5b, 0x5ddbe9580f36ecca},
  {0xcd8440580a8cb347, 0x8b395b802547e6d8},
  {0x4338e255f15fc0d9, 0xf2400716b60d1c2c},
  {0xc0a4a5181cf7a401, 0x208e7b27a3d4e578},
  {0x6557dd7a9909844a, 0xd7dd867435b17ded},
  {0xe7214501f52038cd, 0xf73bfe485cf7fdd0},
  {0x93443a46972cbc70, 0xd2ca8f42b2d199e0},
  {0xbea25cda0a9de799, 0x51886f07950aef32},
  {0x82824ccfb37df72d, 0x71a58d7df86233f6},
  {0x0ab442c2423ac6e3, 0x5d989eeb2df819bb},
  {0x717b766d60dda065, 0x3899b1af41b28b8b},
  {0x2fffad98c8e94310, 0x9ff893980c381280},
  {0x9d7da6a6ca8c0d82, 0x09c78e0f83da5e2a},
  {0x26b7e85d55753566, 0x48b0fee439062128},
  {0x63896bb7a7a3c638, 0x551438e5f3ff5db9},
  {0x080d9af5ef2e5865, 0x048eccc1b914ae50},
  {0xf081a5f8ab004099, 0x24ffc9670c5492ac},
  {0x7e4178c2bf375b5a, 0xa641e4982d1c8638},
  {0x9f1874733c37691a, 0xa6e59883261af497},
  {0x90068f05a814992d, 0x8f340c2ecb9a2bd2},
  {0x2e0a82ad5f144c70, 0x783eb790b951d2d9},
  {0xbf58c52a82e24af6, 0x190f49c97cd133af},
  {0x29e30e4d37b882a1, 0x217bea750913f0db},
  {0xfe2287c403984038, 0x870bd9dd397e696e},
  {0x49e9bc6efdb97d7d, 0xf75f4c5e88587e96},
  {0xa6223b70299d2836, 0xf27661ea227ab61b},
  {0x4d6b8601ceb750cf, 0xfab6503eb520e48d},
  {0xcaf2dd4a73f67c6c, 0x93f3baaf44fed4e0},
  {0x1ff32e99fc57e662, 0x502b8bb6f2031150},
  {0x1d8b5656e3d694dc, 0xb31de0d77f80372b},
  {0x0f3d13aca2eac302, 0xb6d1f98a81d2cd6d},
  {0x840d8615c90887b8, 0x1d44fc5efe63c574},
  {0xded005c9eb05ef63, 0xdeb4246e55c121bb},
  {0x3409b8d1c43c2415, 0x700c0d1dc307fe8d},
  {0x8b361337911e3002, 0x7920c1039098414c},
  {0xa5dddabdd1beecf5, 0x146aaf12b0d6da5e},
  {0xe1a91d6f2a874e47, 0x0d63fcc83ef069d1},
  {0x0ffd9177c1f3ebb2, 0x9a0cadce706c0cc0},
  {0xc60d34aa0f45f13d, 0x2d0b4ea8c2bfdc70},
  {0x83e36503d6399610, 0x6014c0c7cba2d2f2},
  {0x9cc705d2ecaeca0e, 0x79f83e8c83e7f333},
  {0x58c7035772444ccc, 0x789c6687005b995e},
  {0x6b3d950394c886a1, 0x9b4f4564cd5b92d0},
  {0x872c7f29b6dae6ca, 0xd2a320a97a0d0be9},
  {0x14bb3a90e34016b2, 0xb308fa5fc47ad142},
  {0xc6b31a14ce574546, 0xd7f758f96323f56e},
  {0x046d3862feb271a0, 0x391175405eef9c5e},
  {0xf7654c3e98aff433, 0x92b8d607c0180e5e},
  {0xdfe26a4ee0edcbcf, 0x4c21afb68c481788},
  {0xb9175aa38699a7fa, 0xa26d3569fb705b0a},
  {0xd2955bcc820c812c, 0x29d30f039b37f636},
  {0x37d8c59743ebdc8d, 0x19289d7baab847bc},
  {0x8b8a25c0075e7200, 0x75fcbc7110b551c9},
  {0x8ab2318dd48eb686, 0xca8ee9edf4a5a1e0},
  {0x182033f6233cad5f, 0x743083edee67622b},
  {0xc82b0364e7db3d93, 0x3cec89a9bc59587d},
  {0x4fb362a6d33cdc65, 0xb2f2a5ce567b5b8e},
  {0x90df4043911d6152, 0xfe9e1ef68cc145b2},
  {0x4fcf7b4fcca5200b, 0xaba094d2f96d9249},
  {0x5ac887c31fc3fd76, 0x1845172174cf2944},
  {0x25180f84f6702866, 0xde5223f17c83df5d},
  {0x2863a5b3ae30cdea, 0x610fc2ae8f7cfc74},
  {0x64a4086ca77af644, 0xafe073214eb0e372},
  {0xbdc97dadac10ab50, 0x97cf31c3dfa3a7ad},
  {0x79f2ee819538d167, 0x68555fb401eb2780},
  {0x72e2b904d5c7a7ed, 0x482326aa3e165b1c},
  {0x92f65484dcff7fd8, 0x603faf9bafb86f1e},
  {0x210e7817fff07876, 0xabdf6d8a0dd6d8a5},
  {0xab561f7f19942dec, 0x55f71e3e54c7b523},
  {0x8e7140a742fb2245, 0x34a49c54b5ad70ec},
  {0x6da544268e007b3f, 0xebf2cf33aeaee1c9},
  {0x010679622fe3753e, 0x40228d2a0d402ed0},
  {0x2e128b07e6e4e311, 0x0811ebd4d8dde5b5},
  {0x126cb02cee9ad020, 0x398e5321decfb79c},
  {0x6dfdff51553fb5ff, 0x415b4003d55c33ab},
  {0xd3b7fedc1cd8ab6e, 0x49dc7b6033f0ae60},
  {0x7062ab84db2bbaed, 0xc33060adb11136c6},
  {0xae149ced6b9cc3d3, 0xef2f29a2ebe433ce},
  {0x133ca1e237105dc6, 0x9712a59673f1d79c},
  {0xfcf98569ab4ec844, 0x6a40dd9e8d49194e},
  {0xd73a65ce7e33212a, 0xaa29936469e73794},
  {0x961009e50707fe21, 0x657c63ec063d9f23},
  {0x6b1af6be25650671, 0xce96b0cb11ce0372},
  {0xc7312488beda3b54, 0x9ee42f2347f50335},
  {0x829d638189fca23f, 0xe3123a63017f9509},
  {0xbb40cef8e0e85cea, 0xd8b3a76799622f49},
};

#define GF_exp_invmer_e_1 AIMER_NAMESPACE(GF_exp_invmer_e_1)
void GF_exp_invmer_e_1(GF out, const GF in);
#define GF_exp_invmer_e_2 AIMER_NAMESPACE(GF_exp_invmer_e_2)
void GF_exp_invmer_e_2(GF out, const GF in);
#define GF_exp_mer_e_star AIMER_NAMESPACE(GF_exp_mer_e_star)
void GF_exp_mer_e_star(GF out, const GF in);

#define generate_matrices_L_and_U AIMER_NAMESPACE(generate_matrices_L_and_U)
void generate_matrices_L_and_U(
        GF matrix_L[AIM2_NUM_INPUT_SBOX][AIM2_NUM_BITS_FIELD],
        GF matrix_U[AIM2_NUM_INPUT_SBOX][AIM2_NUM_BITS_FIELD],
        GF vector_b,
        const uint8_t iv[AIM2_IV_SIZE]);

#define generate_matrix_LU AIMER_NAMESPACE(generate_matrix_LU)
void generate_matrix_LU(GF matrix_A[AIM2_NUM_INPUT_SBOX][AIM2_NUM_BITS_FIELD],
                        GF vector_b,
                        const uint8_t iv[AIM2_IV_SIZE]);

#define aim2_sbox_outputs AIMER_NAMESPACE(aim2_sbox_outputs)
void aim2_sbox_outputs(GF sbox_outputs[AIM2_NUM_INPUT_SBOX], const GF pt);

#define aim2 AIMER_NAMESPACE(aim2)
void aim2(uint8_t ct[AIM2_NUM_BYTES_FIELD],
          const uint8_t pt[AIM2_NUM_BYTES_FIELD],
          const uint8_t iv[AIM2_IV_SIZE]);

#endif // AIM2_H
